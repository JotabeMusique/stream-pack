import"../B5Qt9EMX.js";import{b as $,g as C,m as b,p as k,i as q,f as p}from"../ChUo-eeL.js";import{L as w,c as T}from"../B6qJfXvl.js";import{A as N,S as _,E as A}from"../ww_V6aJW.js";import"../DsqdWQfm.js";const I=/cours|leçon|n°/ig,E=/[0-9]{1,3}/g;let u,y,r=null,a=null,d="",S=-1;const c=M();function M(){try{return JSON.parse(window.localStorage.getItem(w+"streamTitles")??"[]")||[]}catch{return[]}}function s(){window.localStorage.setItem(w+"streamTitles",JSON.stringify(c))}async function O(){const{clientId:t,accessToken:e}=C(),n=new _(t,e);u=new N({authProvider:n}),y=new A({apiClient:u}),r=(await u.getTokenInfo()).userId,y.start()}async function R(){if(!r)return;d=(await u.channels.getChannelInfoById(r))?.title??"";const e=document.getElementById("currentTitle");e.textContent=d}async function x(t){if(!r)return;await u.channels.updateChannelInfo(r,{title:t}),document.getElementById("updatingIcon").classList.add("--updating")}function P(t){d=t.streamTitle??"";const n=document.getElementById("currentTitle");n.textContent=d,document.getElementById("updatingIcon").classList.remove("--updating"),o()}function U(t){if(t>=c.length)return;a=t;const e=c[t];o();const n=document.getElementById("title");n.value=p(e),document.getElementById("newTitle").classList.add("--editing")}function D(t){c.splice(t,1),s(),o()}function H(t){if(t<1)return;const e=c.splice(t,1);c.splice(t-1,0,e[0]),s(),o()}function G(t){if(t>c.length-2)return;const e=c.splice(t,1);c.splice(t+1,0,e[0]),s(),o()}async function B(t){const e=c[t];e&&await x(p(e))}function J(){S=c.findIndex(t=>q(p(t),d))}function o(){J();const t=document.getElementById("streamTitles"),e=document.querySelector("#listItemTemplate");t&&(t.innerHTML="",c.forEach((n,l)=>{const i=document.importNode(e.content,!0),m=i.querySelector(".listItem"),v=i.querySelector(".data-category"),f=i.querySelector(".data-title"),L=i.querySelector(".data-subtitle"),h=i.querySelector(".data-suffix");if(l===S&&(m.classList.add("--current"),i.querySelector(".action-activate")?.classList.remove("btn--neutral"),i.querySelector(".action-activate")?.classList.add("btn--active")),v){const g=b(n.category);T&&g&&(m.style.setProperty("--category-background",T[g].primary.background),m.style.setProperty("--category-text",T[g].primary.text)),v.textContent=n.category}f&&(n.title.match(I)?f.innerHTML=n.title.replace(E,"<u>$&</u>"):f.innerHTML=n.title),L&&(L.textContent=n.subtitle),h&&(h.textContent=n.suffix),a===l&&i.querySelector(".action-edit")?.classList.add("btn--active"),i.querySelector(".action-activate")?.addEventListener("click",()=>B(l)),i.querySelector(".action-up")?.addEventListener("click",()=>H(l)),i.querySelector(".action-down")?.addEventListener("click",()=>G(l)),i.querySelector(".action-edit")?.addEventListener("click",()=>U(l)),i.querySelector(".action-delete")?.addEventListener("click",()=>D(l)),t?.append(i)}))}function X(t){t.preventDefault();const e=document.getElementById("title"),n=e.value;e.value="";const l=k(n);if(a!==null){const i=document.getElementById("newTitle");c.splice(a,1,l),i.classList.remove("--editing"),a=null}else c.push(l);s(),o()}function F(t){t.preventDefault();const e=document.getElementById("title");e.value="",document.getElementById("newTitle").classList.remove("--editing"),a=null,o()}function Q(){c.forEach(t=>{if(!t.title.match(I))return;const e=t.title.replace(E,n=>(Number(n)+1).toString());t.title=e}),s(),o()}function W(){c.forEach(t=>{if(!t.title.match(I))return;const e=t.title.replace(E,n=>(Number(n)-1).toString());t.title=e}),s(),o()}async function j(){await B(S+1)}document.addEventListener("DOMContentLoaded",async()=>{$();try{await O(),await R()}catch(t){let e=t.message;try{e=JSON.parse(t.body??"").message??e}catch{}const n=document.getElementById("currentTitle");n.textContent="Impossible de se connecter à Twitch: "+e,n.classList.add("--error")}o(),r&&y.onChannelUpdate(r,P),document.getElementById("nextTitleBtn").addEventListener("click",j),document.getElementById("incrementTitleBtn").addEventListener("click",Q),document.getElementById("decrementTitleBtn").addEventListener("click",W),document.getElementById("newTitle").addEventListener("submit",X),document.getElementById("newTitle").addEventListener("reset",F)});
